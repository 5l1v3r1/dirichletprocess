{
    "collab_server" : "",
    "contents" : "#' Update the component of the Dirichlet process\n#'\n#' Update the cluster assignment for each data point.\n#'\n#' @param dpObj Dirichlet Process object\n#' @return Dirichlet process object with update components.\n#'\n#' @examples\n#' dp <- DirichletProcessGaussian(rnorm(10))\n#' dp <- ClusterComponentUpdate(dp)\n#'\n#' @export\nClusterComponentUpdate <- function(dpObj){\n  UseMethod(\"ClusterComponentUpdate\", dpObj)\n}\n\n#'@export\nClusterComponentUpdate.conjugate <- function(dpObj) {\n\n  y <- dpObj$data\n  n <- dpObj$n\n  alpha <- dpObj$alpha\n\n  clusterLabels <- dpObj$clusterLabels\n  clusterParams <- dpObj$clusterParameters\n  numLabels <- dpObj$numberClusters\n  mdObj <- dpObj$mixingDistribution\n\n  pointsPerCluster <- dpObj$pointsPerCluster\n\n  predictiveArray <- dpObj$predictiveArray\n\n  for (i in seq_len(n)) {\n\n    probs <- numeric(numLabels + 1)\n\n    currentLabel <- clusterLabels[i]\n\n    pointsPerCluster[currentLabel] <- pointsPerCluster[currentLabel] - 1\n\n    probs[1:numLabels] <- pointsPerCluster * Likelihood(mdObj, y[i, , drop = FALSE],\n      clusterParams)\n    probs[numLabels + 1] <- alpha * predictiveArray[i]\n\n    if(all(probs==0)){\n      probs[1:(numLabels+1)] <- 1\n    }\n    newLabel <- sample.int(numLabels + 1, 1, prob = probs)\n\n    dpObj$pointsPerCluster <- pointsPerCluster\n\n    dpObj <- ClusterLabelChange(dpObj, i, newLabel, currentLabel)\n\n    pointsPerCluster <- dpObj$pointsPerCluster\n    clusterLabels <- dpObj$clusterLabels\n    clusterParams <- dpObj$clusterParameters\n    numLabels <- dpObj$numberClusters\n\n  }\n\n  dpObj$pointsPerCluster <- pointsPerCluster\n  dpObj$clusterLabels <- clusterLabels\n  dpObj$clusterParameters <- clusterParams\n  dpObj$numberClusters <- numLabels\n  return(dpObj)\n}\n#'@export\nClusterComponentUpdate.nonconjugate <- function(dpObj) {\n\n  y <- dpObj$data\n  n <- dpObj$n\n  alpha <- dpObj$alpha\n\n  clusterLabels <- dpObj$clusterLabels\n  clusterParams <- dpObj$clusterParameters\n  numLabels <- dpObj$numberClusters\n\n  mdObj <- dpObj$mixingDistribution\n  m <- dpObj$m\n\n  pointsPerCluster <- dpObj$pointsPerCluster\n\n  aux <- list()\n\n  for (i in seq_len(n)) {\n\n    probs <- numeric(numLabels + 1)\n\n    currentLabel <- clusterLabels[i]\n\n    pointsPerCluster[currentLabel] <- pointsPerCluster[currentLabel] - 1\n\n    if (pointsPerCluster[currentLabel] == 0) {\n\n      PriorDraws <- PriorDraw(mdObj, m - 1)\n\n      for (j in seq_along(PriorDraws)) {\n        aux[[j]] <- array(c(clusterParams[[j]][, , currentLabel], PriorDraws[[j]]),\n          dim = c(dim(PriorDraws[[j]])[1:2], m))\n      }\n    } else {\n        aux <- PriorDraw(mdObj, m)\n    }\n\n    probs[1:numLabels] <- pointsPerCluster * Likelihood(mdObj, y[i, , drop = FALSE],\n      clusterParams)\n    probs[(numLabels + 1):(numLabels + m)] <- (alpha/m) * Likelihood(mdObj, y[i, , drop = FALSE], aux)\n\n    if (any(is.nan(probs))) {\n      probs[is.nan(probs)] <- 0\n    }\n\n    if (anyNA(probs)) {\n      probs[is.na(probs)] <- 0\n    }\n\n    if (any(is.infinite(probs))) {\n      probs[is.infinite(probs)] <- 1\n      probs[-is.infinite(probs)] <- 0\n    }\n\n    if (all(probs == 0)) {\n      probs <- rep_len(1, length(probs))\n    }\n    newLabel <- sample.int(numLabels + m, 1, prob = probs)\n\n    dpObj$pointsPerCluster <- pointsPerCluster\n\n    dpObj <- ClusterLabelChange(dpObj, i, newLabel, currentLabel, aux)\n\n    pointsPerCluster <- dpObj$pointsPerCluster\n    clusterLabels <- dpObj$clusterLabels\n    clusterParams <- dpObj$clusterParameters\n    numLabels <- dpObj$numberClusters\n\n  }\n\n  dpObj$pointsPerCluster <- pointsPerCluster\n  dpObj$clusterLabels <- clusterLabels\n  dpObj$clusterParameters <- clusterParams\n  dpObj$numberClusters <- numLabels\n  return(dpObj)\n}\n\nClusterComponentUpdate.hierarchical <- function(dpobj){\n\n  for(i in seq_along(dpobj$indDP)){\n    dpobj$indDP[[i]] <- ClusterComponentUpdate(dpobj$indDP[[i]])\n    dpobj$indDP[[i]] <- DuplicateClusterRemove(dpobj$indDP[[i]])\n  }\n  return(dpobj)\n}\n\n\n\n\n",
    "created" : 1507557139481.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3189771947",
    "id" : "7E3F373B",
    "lastKnownWriteTime" : 1504792158,
    "last_content_update" : 1504792158,
    "path" : "~/Documents/PhD/Research/Dirichelet/dirichletprocess/R/cluster_component_update.R",
    "project_path" : "R/cluster_component_update.R",
    "properties" : {
        "marks" : "<:0,0\n>:0,0"
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}